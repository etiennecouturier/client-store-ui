<div class="clients-container">
  <mat-card class="personal-info-card light-grey-background">
    <mat-card-header>
      <mat-form-field class="centralized">
        <input matInput type="text" [(ngModel)]="client.name" [disabled]="!edit"/>
      </mat-form-field>
      <mat-icon *ngIf="client.sex == 'F'"
                matTooltip="Nem"
                aria-label="View"
                color="accent">female</mat-icon>
      <mat-icon *ngIf="client.sex == 'M'"
                matTooltip="Nem"
                aria-label="View"
                color="accent">male</mat-icon>
    </mat-card-header>
    <mat-card-content class="flex-container">
      <div class="flex-child">
        <div class="flex-line red">szül. év</div>
        <mat-form-field class="flex-line">
          <input matInput [max]="today"
                 [ngModel]="client.dob"
                 (ngModelChange)="client.dob = $event; calculateAge()"
                 [matDatepicker]="picker"
                 [disabled]="!edit">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <div class="flex-line red">kor</div>
        <mat-form-field class="flex-line">
          <input matInput type="text" [(ngModel)]="client.age" [disabled]="true"/>
        </mat-form-field>
      </div>
      <div class="flex-child">
        <div class="flex-line red">tel</div>
        <mat-form-field class="flex-line">
          <input matInput
                 type="text"
                 phoneMask
                 [disabled]="!edit"
                 [ngModel]="client.tel"
                 (ngModelChange)="client.tel = $event"/>
        </mat-form-field>
        <div class="flex-line red">email</div>
        <mat-form-field class="flex-line">
          <input matInput type="text" [(ngModel)]="client.email" [disabled]="!edit"/>
        </mat-form-field>
      </div>
    </mat-card-content>
    <button mat-icon-button color="accent"
            (click)="edit=!edit;anyUnderEdit=true"
            *ngIf="!edit"
            [disabled]="anyUnderEdit && !edit">
      <mat-icon aria-label="Edit">edit</mat-icon>
    </button>
    <button mat-icon-button color="accent" (click)="save()" *ngIf="edit">
      <mat-icon aria-label="Save">check</mat-icon>
    </button>

    <button mat-icon-button color="accent" (click)="cancel()" *ngIf="edit">
      <mat-icon aria-label="Cancel">cancel</mat-icon>
    </button>
  </mat-card>
  <mat-card-actions>
    <button mat-icon-button color="accent"
            (click)="addNewVisit()"
            [disabled]="anyUnderEdit || client.id == null">
      <mat-icon aria-label="Add">add</mat-icon>
    </button>
  </mat-card-actions>
</div>

<div class="clients-container">
  <visit *ngFor="let visit of client.visits;let i = index"
         [visit]="visit"
         [anyUnderEdit]="anyUnderEdit"
         (editStarted)="anyUnderEdit=true"
         (save)="save()"
         (del)="openDialog(i)"
         (cancel)="cancel()">
  </visit>
</div>
